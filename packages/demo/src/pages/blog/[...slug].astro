---
import { getAllPostsForPaths } from '@/utils/blog';
import '@shared/styles/index.css';
import '@/styles/tailwind.css';
import '@/styles/global.css';
import ThemeToggle from '@shared/components/ThemeToggle.svelte';
import Toast from '@astro-v5/shared/components/Toast.astro';
import WebVitals from '@astro-v5/shared/components/WebVitals.astro';
import BlogSEO from '@astro-v5/shared/components/seo/BlogSEO.astro';
import { env } from '@/env';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  return await getAllPostsForPaths();
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props as Props;
// biome-ignore lint/correctness/noUnusedVariables: Content wird im Astro-Template verwendet
const { Content } = await post.render();

const siteName = env.PUBLIC_SITE_NAME;
const slug = post.slug || post.id;
---

<!doctype html>
<html lang="de" class="scroll-smooth">
<script is:inline>
  // Theme initialization
  (function() {
    const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    const html = document.documentElement;

    if (theme === 'dark') {
      html.classList.add('dark');
      html.setAttribute('data-theme', 'dark');
    } else {
      html.classList.remove('dark');
      html.setAttribute('data-theme', 'light');
    }
  })();
</script>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{post.data.title} | {siteName}</title>

	<!-- Blog SEO Component - Pass available fields, missing fields are gracefully omitted -->
	<BlogSEO
		title={post.data.title}
		description={post.data.description}
		publishDate={post.data.date}
		slug={slug}
		author={post.data.author}
		category={post.data.tags?.[0]}
		image={post.data.image}
		keywords={post.data.tags}
		siteName={siteName}
	/>

	<!-- Favicon -->
	<link rel="icon" type="image/svg+xml" href="/favicon.svg">
	<link rel="alternate" type="application/rss+xml" title={siteName} href="/rss.xml">

	<!-- Preconnect to external domains -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col transition-all duration-500 ease-in-out font-inter">
<header class="py-4 px-4 sm:py-6 sm:px-6 bg-transparent">
	<nav class="flex justify-between items-center max-w-6xl mx-auto">
		<ul class="hidden md:flex gap-8 list-none p-0 m-0">
			<li><a href="/" class="text-slate-900 dark:text-slate-100 no-underline text-base font-medium hover:text-slate-600 dark:hover:text-slate-300 transition-all duration-200">Home</a></li>
			<li><a href="/blog" class="text-slate-900 dark:text-slate-100 no-underline text-base font-medium hover:text-slate-600 dark:hover:text-slate-300 transition-all duration-200">Blog</a></li>
			<li><a href="/contact" class="text-slate-900 dark:text-slate-100 no-underline text-base font-medium hover:text-slate-600 dark:hover:text-slate-300 transition-all duration-200">Contact</a></li>
		</ul>
		<ThemeToggle client:load />
	</nav>
</header>
<main class="flex-1 px-4 sm:px-6 py-8">
	<div class="max-w-7xl mx-auto">

	<!-- Background with floating orbs -->
	<div class="fixed inset-0 pointer-events-none overflow-hidden">
		<div class="cs-orb cs-orb-lg opacity-5 animate-pulse" style="top: 20%; right: 10%; animation-duration: 12s;"></div>
		<div class="cs-orb cs-orb-md opacity-10 animate-bounce" style="top: 70%; left: 5%; animation-delay: 3s; animation-duration: 8s;"></div>
	</div>

	<article class="max-w-5xl mx-auto relative">
		<!-- Header with Atlas styling -->
		<header class="mb-16">
			<nav class="mb-8">
				<a href="/blog/" class="inline-flex items-center gap-2 cs-glass px-4 py-2 rounded-xl hover:cs-glass-lg transition-all duration-300 hover:-translate-y-1">
					<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
					</svg>
					Zurück zum Blog
				</a>
			</nav>

			<!-- Title with gradient effect -->
			<div class="cs-glass-sm p-8 rounded-3xl mb-8">
				<h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold cs-gradient-text cs-gradient-animate mb-8 text-center">
					{post.data.title}
				</h1>

				<!-- Meta Information with Atlas styling -->
				<div class="flex flex-wrap items-center justify-center gap-8 text-sm opacity-80 mb-6">
					{post.data.date && (
						<div class="flex items-center gap-2 cs-glass-sm px-4 py-2 rounded-full">
							<svg class="w-4 h-4 text-cyan-500" fill="currentColor" viewBox="0 0 24 24">
								<path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
							</svg>
							<time datetime={post.data.date}>
							{new Date(post.data.date).toLocaleDateString('de-DE', {
									year: 'numeric',
									month: 'long',
									day: 'numeric'
								})}
							</time>
						</div>
					)}
					{post.data.author && (
						<div class="flex items-center gap-2 cs-glass-sm px-4 py-2 rounded-full">
							<svg class="w-4 h-4 text-purple-500" fill="currentColor" viewBox="0 0 24 24">
								<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
							</svg>
							<span>von {post.data.author}</span>
						</div>
					)}
				</div>

				<!-- Tags with Atlas styling -->
				{post.data.tags && post.data.tags.length > 0 && (
					<div class="flex flex-wrap gap-3 justify-center">
					{post.data.tags.map((tag: string) => (
							<span class="cs-glass px-4 py-2 rounded-full font-medium hover:cs-glass-lg transition-all duration-300 hover:scale-105">
								{tag}
							</span>
						))}
					</div>
				)}
			</div>

			<!-- Description with Atlas styling -->
			{post.data.description && (
				<div class="cs-glass p-6 rounded-2xl mb-8 text-center">
					<p class="text-xl text-gray-700 dark:text-gray-200 leading-relaxed italic">
						{post.data.description}
					</p>
				</div>
			)}

			<!-- Image with Atlas styling -->
			{post.data.image && (
				<div class="relative group mb-12">
					<div class="cs-glass p-2 rounded-3xl">
						<img
							src={post.data.image}
							alt={post.data.title}
							class="w-full h-80 object-cover rounded-2xl group-hover:scale-[1.02] transition-transform duration-700"
							loading="lazy"
						/>
					</div>
					<!-- Floating orbs around image -->
					<div class="absolute inset-0 pointer-events-none">
						<div class="cs-orb cs-orb-sm opacity-20 animate-pulse" style="top: 10%; left: -5%; animation-delay: 1s;"></div>
						<div class="cs-orb cs-orb-xs opacity-30 animate-bounce" style="bottom: 15%; right: -3%; animation-delay: 2s;"></div>
					</div>
				</div>
			)}
		</header>

		<!-- Content with enhanced Atlas styling -->
		<div class="cs-glass-sm p-8 rounded-3xl">
			<div class="prose prose-lg max-w-none dark:prose-invert
				[&>h1]:cs-gradient-text [&>h1]:text-4xl [&>h1]:font-bold [&>h1]:mb-8 [&>h1]:mt-12 [&>h1]:text-center
				[&>h2]:cs-gradient-text [&>h2]:text-3xl [&>h2]:font-bold [&>h2]:mb-6 [&>h2]:mt-10
				[&>h3]:text-2xl [&>h3]:font-semibold [&>h3]:text-gray-800 [&>h3]:dark:text-white [&>h3]:mb-4 [&>h3]:mt-8
				[&>p]:text-gray-700 [&>p]:dark:text-gray-200 [&>p]:leading-relaxed [&>p]:mb-6 [&>p]:text-lg
				[&>a]:cs-gradient-text [&>a]:no-underline [&>a]:hover:underline [&>a]:font-medium
				[&>strong]:text-gray-800 [&>strong]:dark:text-white [&>strong]:font-bold
				[&>code]:text-cyan-600 [&>code]:dark:text-cyan-400 [&>code]:cs-glass-sm [&>code]:px-3 [&>code]:py-1 [&>code]:rounded [&>code]:text-sm [&>code]:font-mono
				[&>pre]:cs-glass [&>pre]:p-6 [&>pre]:rounded-2xl [&>pre]:overflow-x-auto [&>pre]:mb-8 [&>pre]:border [&>pre]:border-white/20
				[&>blockquote]:cs-glass [&>blockquote]:border-l-4 [&>blockquote]:border-gradient-to-b [&>blockquote]:from-cyan-500 [&>blockquote]:to-purple-500 [&>blockquote]:p-6 [&>blockquote]:rounded-r-2xl [&>blockquote]:mb-8 [&>blockquote]:italic
				[&>ul]:list-none [&>ul]:space-y-2 [&>ul]:mb-6
				[&>li]:relative [&>li]:pl-6 [&>li]:text-gray-700 [&>li]:dark:text-gray-200
				[&>li]:before:content-['•'] [&>li]:before:absolute [&>li]:before:left-0 [&>li]:before:text-cyan-500 [&>li]:before:font-bold
				[&>hr]:border-none [&>hr]:h-px [&>hr]:bg-gradient-to-r [&>hr]:from-transparent [&>hr]:via-gray-300 [&>hr]:dark:via-gray-600 [&>hr]:to-transparent [&>hr]:my-12
			">
				<Content />
			</div>
		</div>

		<!-- Footer with Atlas styling -->
		<footer class="mt-16">
			<div class="cs-glass p-8 rounded-3xl text-center">
				<div class="flex items-center justify-center gap-4 mb-6">
					<div class="h-px bg-gradient-to-r from-transparent via-cyan-500 to-transparent w-20"></div>
					<div class="cs-orb cs-orb-xs animate-pulse"></div>
					<div class="h-px bg-gradient-to-r from-transparent via-purple-500 to-transparent w-20"></div>
				</div>

				<p class="text-gray-600 dark:text-gray-300 mb-6">
					Danke fürs Lesen! Entdecke weitere Artikel in unserem Blog.
				</p>

				<a
					href="/blog/"
					class="inline-flex items-center gap-3 cs-glass px-6 py-3 rounded-xl hover:cs-glass-lg transition-all duration-300 hover:-translate-y-1 cs-gradient-text font-semibold"
				>
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
					</svg>
					Alle Artikel ansehen
				</a>
			</div>
		</footer>
	</article>

	</div>
</main>
<footer class="text-center text-gray-500 dark:text-gray-400 py-4 sm:py-6 px-4">
	<p>&copy; 2025 {siteName}</p>
</footer>
<Toast />
<WebVitals debug={import.meta.env.DEV} />
</body>
</html>

<script>
	// Demo functionality for blog posts
	document.addEventListener('DOMContentLoaded', function() {
		// Counter demo
		const counterButton = document.getElementById('demo-counter');
		const counterSpan = document.getElementById('counter');

		if (counterButton && counterSpan) {
			let count = 0;
			counterButton.addEventListener('click', function() {
				count++;
				counterSpan.textContent = count.toString();
			});
		}

		// Animation demo
		const fadeBtn = document.getElementById('fade-btn');
		const slideBtn = document.getElementById('slide-btn');
		const resetBtn = document.getElementById('reset-btn');
		const demoElement = document.getElementById('demo-element');

		if (fadeBtn && demoElement) {
			fadeBtn.addEventListener('click', function() {
				demoElement.style.opacity = '0.3';
				demoElement.style.transform = 'scale(0.8)';
			});
		}

		if (slideBtn && demoElement) {
			slideBtn.addEventListener('click', function() {
				demoElement.style.transform = 'translateX(100px) rotate(45deg)';
			});
		}

		if (resetBtn && demoElement) {
			resetBtn.addEventListener('click', function() {
				demoElement.style.opacity = '1';
				demoElement.style.transform = 'none';
			});
		}

		// Tailwind demo
		const colorBtn = document.getElementById('color-btn');
		const sizeBtn = document.getElementById('size-btn');
		const demoBox = document.getElementById('demo-box');

		if (colorBtn && demoBox) {
			colorBtn.addEventListener('click', function() {
				const colors = ['bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-yellow-500'];
				const currentColor = demoBox.className.match(/bg-\w+-500/);
				const currentIndex = colors.indexOf(currentColor ? currentColor[0] : 'bg-red-500');
				const nextIndex = (currentIndex + 1) % colors.length;
				demoBox.className = demoBox.className.replace(/bg-\w+-500/, colors[nextIndex]);
			});
		}

		if (sizeBtn && demoBox) {
			sizeBtn.addEventListener('click', function() {
				const sizes = ['w-32 h-32', 'w-40 h-40', 'w-48 h-48', 'w-32 h-32'];
				const currentSize = demoBox.className.match(/w-\d+ h-\d+/);
				const currentIndex = sizes.indexOf(currentSize ? currentSize[0] : 'w-32 h-32');
				const nextIndex = (currentIndex + 1) % sizes.length;
				demoBox.className = demoBox.className.replace(/w-\d+ h-\d+/, sizes[nextIndex]);
			});
		}
	});
</script>
