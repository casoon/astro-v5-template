---
import { env } from '@/env';

export interface Props {
  title: string;
  description?: string;
  date: string;
  author?: string;
  image?: string;
  slug: string;
  tags?: string[];
  variant?: 'default' | 'featured' | 'minimal';
}

const {
  title,
  description,
  date,
  author,
  image,
  slug,
  tags = [],
  variant = 'default'
} = Astro.props;

const locale = env.PUBLIC_LOCALE || 'en';

const cardClasses = {
  default: 'backdrop-blur-md hover:backdrop-blur-lg',
  featured: 'backdrop-blur-lg',
  minimal: 'backdrop-blur-sm hover:backdrop-blur-md'
};

const cardStyles = {
  default: 'background: var(--cs-glass-bg-light); border: 1px solid var(--cs-glass-border-light);',
  featured: 'background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(6, 182, 212, 0.15)); border: 2px solid var(--cs-glass-border-medium);',
  minimal: 'background: var(--cs-glass-bg-xs); border: 1px solid var(--cs-glass-border-xs);'
};

const tagVariants = {
  default: 'backdrop-blur-sm',
  featured: 'backdrop-blur-sm bg-gradient-to-r from-purple-600 to-cyan-600 text-white shadow-lg',
  minimal: 'backdrop-blur-sm'
};

const tagStyles = {
  default: 'background: rgba(255, 255, 255, 0.2); color: rgb(71, 85, 105); border: 1px solid rgba(148, 163, 184, 0.3);',
  featured: '',
  minimal: 'background: rgba(255, 255, 255, 0.15); color: rgb(100, 116, 139); border: 1px solid rgba(148, 163, 184, 0.2);'
};

const textClasses = {
  default: 'text-slate-700 dark:text-slate-200',
  featured: 'text-slate-800 dark:text-white',
  minimal: 'text-slate-600 dark:text-slate-300'
};

const metaClasses = {
  default: 'text-sm text-slate-500 dark:text-slate-400',
  featured: 'text-sm text-slate-600 dark:text-slate-300',
  minimal: 'text-sm text-slate-500 dark:text-slate-400'
};

const titleClasses = {
  default: 'text-slate-900 dark:text-white',
  featured: 'text-slate-900 dark:text-white',
  minimal: 'text-slate-900 dark:text-white'
};
---

<article class={`group ${cardClasses[variant]} rounded-2xl overflow-hidden transition-all duration-500 hover:scale-[1.02] hover:-translate-y-1`} style={cardStyles[variant]}>
  <!-- Image or Placeholder -->
  <div class="relative aspect-video overflow-hidden bg-gradient-to-br from-cyan-500/20 to-purple-500/20">
    {image ? (
      <img
        src={image}
        alt={title}
        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 ease-out"
        loading="lazy"
      />
    ) : (
      <div class="w-full h-full flex items-center justify-center cs-gradient-ocean">
        <div class="cs-glass p-4 rounded-full">
          <svg
            class="w-12 h-12 text-white drop-shadow-lg"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5"
              d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"
            />
          </svg>
        </div>
      </div>
    )}

    <!-- Floating orbs for visual interest -->
    <div class="absolute inset-0 pointer-events-none">
      <div class="cs-orb cs-orb-sm opacity-20 animate-pulse" style="top: 20%; left: 15%;"></div>
      <div class="cs-orb cs-orb-xs opacity-30 animate-bounce" style="top: 60%; right: 20%; animation-delay: 0.5s;"></div>
    </div>

    <!-- Featured badge for featured variant -->
    {variant === 'featured' && (
      <div class="absolute top-4 right-4 cs-gradient-sunset px-3 py-1 rounded-full text-white text-sm font-semibold shadow-lg">
        ‚≠ê Featured
      </div>
    )}
  </div>

  <!-- Content -->
  <div class="p-6 space-y-4">
    <!-- Meta Information -->
    <div class={`flex items-center justify-between ${metaClasses[variant]}`}>
      <time datetime={date} class="flex items-center gap-1">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
        </svg>
        {new Date(date).toLocaleDateString(locale, {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        })}
      </time>
      {author && (
        <span class="flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
          <span class="sr-only">Author:</span>
          {author}
        </span>
      )}
    </div>

    <!-- Title with better contrast -->
    <h2 class={`text-xl font-bold transition-all duration-300 ${titleClasses[variant]} ${
      variant === 'featured'
        ? 'group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-purple-600 group-hover:to-cyan-600'
        : 'group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-cyan-600 group-hover:to-purple-600'
    }`}>
      <a href={`/blog/${slug}/`} class="block" aria-label={`Read article: ${title}`}>
        {title}
      </a>
    </h2>

    <!-- Description -->
    {description && (
      <p class={`line-clamp-3 leading-relaxed ${textClasses[variant]}`}>
        {description}
      </p>
    )}

    <!-- Tags -->
    {tags.length > 0 && (
      <div class="flex flex-wrap gap-2">
        {tags.slice(0, 3).map((tag: string) => (
          <span class={`px-3 py-1 text-xs rounded-full font-medium transition-all duration-300 hover:scale-105 ${tagVariants[variant]}`} style={tagStyles[variant]}>
            {tag}
          </span>
        ))}
        {tags.length > 3 && (
          <span class="px-3 py-1 text-xs backdrop-blur-sm rounded-full font-medium" style="background: rgba(255, 255, 255, 0.15); color: rgb(100, 116, 139); border: 1px solid rgba(148, 163, 184, 0.2);">
            +{tags.length - 3}
          </span>
        )}
      </div>
    )}

    <!-- Read More Link -->
    <div class="pt-2">
      <a
        href={`/blog/${slug}/`}
        class="inline-flex items-center gap-2 cs-gradient-text hover:cs-gradient-animate font-semibold transition-all duration-300 hover:gap-3 group/link"
        aria-label={`Read full article: ${title}`}
      >
        Read article
        <svg class="w-4 h-4 transition-transform group-hover/link:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </a>
    </div>
  </div>

  <!-- Subtle animation overlay -->
  <div class="absolute inset-0 bg-gradient-to-t from-transparent via-transparent to-white/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
</article>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
