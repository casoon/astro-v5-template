---
import { getAllPostsForPaths } from '@/utils/blog';
import '@shared/styles/index.css';
import '@/styles/tailwind.css';
import '@/styles/global.css';
import ThemeToggle from '@shared/components/ThemeToggle.svelte';
import Toast from '@astro-v5/shared/components/Toast.astro';
import WebVitals from '@astro-v5/shared/components/WebVitals.astro';
import BlogSEO from '@astro-v5/shared/components/seo/BlogSEO.astro';
import { env } from '@/env';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  return await getAllPostsForPaths();
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props as Props;
// biome-ignore lint/correctness/noUnusedVariables: Content wird im Astro-Template verwendet
const { Content } = await post.render();

const siteName = env.PUBLIC_SITE_NAME;
const slug = post.slug || post.id;
---

<!doctype html>
<html lang="de" class="scroll-smooth">
<script is:inline>
  // Theme initialization
  (function() {
    const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    const html = document.documentElement;

    if (theme === 'dark') {
      html.classList.add('dark');
      html.setAttribute('data-theme', 'dark');
    } else {
      html.classList.remove('dark');
      html.setAttribute('data-theme', 'light');
    }
  })();
</script>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{post.data.title} | {siteName}</title>

	<!-- Blog SEO Component - Pass available fields, missing fields are gracefully omitted -->
	<BlogSEO
		title={post.data.title}
		description={post.data.description}
		publishDate={post.data.date}
		slug={slug}
		author={post.data.author}
		category={post.data.tags?.[0]}
		image={post.data.image}
		keywords={post.data.tags}
		siteName={siteName}
	/>

	<!-- Favicon -->
	<link rel="icon" type="image/svg+xml" href="/favicon.svg">
	<link rel="alternate" type="application/rss+xml" title={siteName} href="/rss.xml">

	<!-- Preconnect to external domains -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="min-h-screen bg-white dark:bg-slate-900 flex flex-col transition-colors duration-300 font-inter">
<header class="sticky top-0 z-50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-800 py-4 px-4 sm:py-4 sm:px-6">
	<nav class="flex justify-between items-center max-w-4xl mx-auto">
		<ul class="hidden md:flex gap-8 list-none p-0 m-0">
			<li><a href="/" class="text-gray-700 dark:text-gray-200 no-underline text-base font-medium hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">Home</a></li>
			<li><a href="/blog" class="text-gray-700 dark:text-gray-200 no-underline text-base font-medium hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">Blog</a></li>
			<li><a href="/contact" class="text-gray-700 dark:text-gray-200 no-underline text-base font-medium hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">Kontakt</a></li>
		</ul>
		<ThemeToggle client:load />
	</nav>
</header>

<main class="flex-1 px-4 sm:px-6 py-12">
	<article class="max-w-4xl mx-auto">
		<!-- Back Navigation -->
		<nav class="mb-8">
			<a href="/blog/" class="inline-flex items-center gap-2 text-gray-600 dark:text-gray-300 hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200 font-medium">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
				</svg>
				Zurück zum Blog
			</a>
		</nav>

		<!-- Article Header -->
		<header class="mb-12 space-y-6">
			<!-- Title -->
			<h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-gray-900 dark:text-white leading-tight">
				{post.data.title}
			</h1>

			<!-- Meta Information -->
			<div class="flex flex-wrap items-center gap-6 text-sm text-gray-600 dark:text-gray-400">
				{post.data.date && (
					<div class="flex items-center gap-2">
						<svg class="w-5 h-5 text-purple-500" fill="currentColor" viewBox="0 0 24 24">
							<path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
						</svg>
						<time datetime={post.data.date}>
							{new Date(post.data.date).toLocaleDateString('de-DE', {
								year: 'numeric',
								month: 'long',
								day: 'numeric'
							})}
						</time>
					</div>
				)}
				{post.data.author && (
					<div class="flex items-center gap-2">
						<svg class="w-5 h-5 text-purple-500" fill="currentColor" viewBox="0 0 24 24">
							<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
						</svg>
						<span>{post.data.author}</span>
					</div>
				)}
			</div>

			<!-- Tags -->
			{post.data.tags && post.data.tags.length > 0 && (
				<div class="flex flex-wrap gap-2">
					{post.data.tags.map((tag: string) => (
						<span class="px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-full text-sm font-medium">
							{tag}
						</span>
					))}
				</div>
			)}

			<!-- Description -->
			{post.data.description && (
				<p class="text-xl text-gray-700 dark:text-gray-300 leading-relaxed border-l-4 border-purple-500 pl-6 py-2 italic bg-gray-50 dark:bg-gray-800/50 rounded-r-lg">
					{post.data.description}
				</p>
			)}

			<!-- Featured Image -->
			{post.data.image && (
				<figure class="space-y-2">
					<div class="relative rounded-2xl overflow-hidden shadow-xl">
						<img
							src={post.data.image}
							alt={post.data.title}
							class="w-full h-auto object-cover"
							loading="eager"
						/>
					</div>
					<figcaption class="text-sm text-gray-500 dark:text-gray-400 text-center italic">
						Bildquelle: {post.data.imageSource || 'Unsplash'}
					</figcaption>
				</figure>
			)}
		</header>

		<!-- Article Content -->
		<div class="prose prose-lg max-w-none dark:prose-invert
			prose-headings:font-bold prose-headings:text-gray-900 dark:prose-headings:text-white
			prose-h1:text-4xl prose-h1:mb-8 prose-h1:mt-12
			prose-h2:text-3xl prose-h2:mb-6 prose-h2:mt-10 prose-h2:pb-2 prose-h2:border-b prose-h2:border-gray-200 dark:prose-h2:border-gray-700
			prose-h3:text-2xl prose-h3:mb-4 prose-h3:mt-8
			prose-p:text-gray-700 dark:prose-p:text-gray-300 prose-p:leading-relaxed prose-p:mb-6
			prose-a:text-purple-600 dark:prose-a:text-purple-400 prose-a:no-underline hover:prose-a:underline prose-a:font-medium prose-a:transition-colors
			prose-strong:text-gray-900 dark:prose-strong:text-white prose-strong:font-bold
			prose-code:text-purple-600 dark:prose-code:text-purple-400 prose-code:bg-purple-50 dark:prose-code:bg-purple-950/30 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:before:content-none prose-code:after:content-none
			prose-pre:bg-gray-900 dark:prose-pre:bg-gray-950 prose-pre:text-gray-100 prose-pre:p-6 prose-pre:rounded-xl prose-pre:overflow-x-auto prose-pre:shadow-lg prose-pre:border prose-pre:border-gray-700
			[&_pre_code]:!bg-transparent [&_pre_code]:!text-gray-100 [&_pre_code]:!p-0 [&_pre_code]:before:!content-none [&_pre_code]:after:!content-none
			prose-blockquote:border-l-4 prose-blockquote:border-purple-500 prose-blockquote:bg-gray-50 dark:prose-blockquote:bg-gray-800/50 prose-blockquote:pl-6 prose-blockquote:py-4 prose-blockquote:rounded-r-lg prose-blockquote:italic prose-blockquote:text-gray-700 dark:prose-blockquote:text-gray-300
			prose-ul:list-disc prose-ul:pl-6 prose-ul:space-y-2
			prose-ol:list-decimal prose-ol:pl-6 prose-ol:space-y-2
			prose-li:text-gray-700 dark:prose-li:text-gray-300 prose-li:marker:text-purple-500
			prose-hr:border-gray-300 dark:prose-hr:border-gray-700 prose-hr:my-12
			prose-img:rounded-xl prose-img:shadow-lg prose-img:my-8
			prose-table:border-collapse prose-table:w-full
			prose-th:bg-gray-100 dark:prose-th:bg-gray-800 prose-th:p-3 prose-th:text-left prose-th:font-semibold prose-th:border prose-th:border-gray-300 dark:prose-th:border-gray-700
			prose-td:p-3 prose-td:border prose-td:border-gray-300 dark:prose-td:border-gray-700
		">
			<Content />
		</div>

		<!-- Article Footer -->
		<footer class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-800">
			<div class="bg-gradient-to-r from-purple-50 to-cyan-50 dark:from-purple-900/20 dark:to-cyan-900/20 rounded-2xl p-8 text-center space-y-6">
				<p class="text-lg text-gray-700 dark:text-gray-300">
					Danke fürs Lesen! Entdecke weitere spannende Artikel.
				</p>

				<a
					href="/blog/"
					class="inline-flex items-center gap-3 bg-gradient-to-r from-purple-600 to-cyan-600 hover:from-purple-700 hover:to-cyan-700 text-white font-semibold px-6 py-3 rounded-xl transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5"
				>
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
					</svg>
					Alle Artikel ansehen
				</a>
			</div>
		</footer>
	</article>
</main>

<footer class="text-center text-gray-500 dark:text-gray-400 py-8 px-4 border-t border-gray-200 dark:border-gray-800">
	<p>&copy; 2025 {siteName}</p>
</footer>

<Toast />
<WebVitals debug={import.meta.env.DEV} />
</body>
</html>
