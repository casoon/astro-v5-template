---
interface MenuItem {
  href: string;
  label: string;
}

interface Props {
  items: MenuItem[];
}

const { items } = Astro.props;
---

<!-- Mobile Menu Button -->
<button
  id="mobile-menu-button"
  class="md:hidden flex flex-col justify-center items-center w-8 h-8 space-y-1"
  aria-label="Toggle mobile menu"
  aria-expanded="false"
>
  <span class="block w-6 h-0.5 bg-slate-900 dark:bg-slate-100 transition-all duration-200"></span>
  <span class="block w-6 h-0.5 bg-slate-900 dark:bg-slate-100 transition-all duration-200"></span>
  <span class="block w-6 h-0.5 bg-slate-900 dark:bg-slate-100 transition-all duration-200"></span>
</button>

<!-- Mobile Navigation Menu -->
<div
  id="mobile-menu"
  class="md:hidden hidden glass-effect border-t border-slate-200 dark:border-slate-700"
  role="navigation"
  aria-label="Mobile navigation"
>
  <ul class="flex flex-col py-4 px-6 space-y-2 list-none">
    {items.map((item) => (
      <li>
        <a href={item.href} class="nav-link-mobile">
          {item.label}
        </a>
      </li>
    ))}
  </ul>
</div>

<script is:inline>
  // Mobile menu functionality
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuLines = mobileMenuButton?.querySelectorAll('span');

    if (!mobileMenuButton || !mobileMenu || !menuLines || menuLines.length < 3) return;

    const toggleMenu = function() {
      if (!mobileMenu || !menuLines) return;
      const isOpen = !mobileMenu.classList.contains('hidden');

      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    };

    const openMenu = function() {
      if (!mobileMenu || !menuLines || !mobileMenuButton) return;

      mobileMenu.classList.remove('hidden');
      mobileMenuButton.setAttribute('aria-expanded', 'true');

      // Transform to X icon
      menuLines[0]?.classList.add('rotate-45', 'translate-y-2');
      menuLines[1]?.classList.add('opacity-0');
      menuLines[2]?.classList.add('-rotate-45', '-translate-y-2');
    };

    const closeMenu = function() {
      if (!mobileMenu || !menuLines || !mobileMenuButton) return;

      mobileMenu.classList.add('hidden');
      mobileMenuButton.setAttribute('aria-expanded', 'false');

      // Reset hamburger icon
      menuLines[0]?.classList.remove('rotate-45', 'translate-y-2');
      menuLines[1]?.classList.remove('opacity-0');
      menuLines[2]?.classList.remove('-rotate-45', '-translate-y-2');
    };

    // Toggle menu on button click
    mobileMenuButton.addEventListener('click', toggleMenu);

    // Close menu when clicking on a link
    const mobileLinks = mobileMenu.querySelectorAll('a');
    mobileLinks.forEach(function(link) {
      link.addEventListener('click', closeMenu);
    });

    // Close menu when clicking outside
    document.addEventListener('click', function(event) {
      if (!mobileMenuButton || !mobileMenu) return;
      const target = event.target;
      if (!mobileMenuButton.contains(target) && !mobileMenu.contains(target)) {
        closeMenu();
      }
    });

    // Close menu on escape key
    document.addEventListener('keydown', function(event) {
      if (!mobileMenu) return;
      if (event.key === 'Escape' && !mobileMenu.classList.contains('hidden')) {
        closeMenu();
      }
    });
  });
</script>
