---
import type { BaseEnv } from '@astro-v5/shared/utils/env';

export interface Props {
  title: string;
  description?: string;
  date: string;
  author?: string;
  image?: string;
  slug: string;
  tags?: string[];
  variant?: 'default' | 'featured' | 'minimal';
}

const {
  title,
  description,
  date,
  author,
  image,
  slug,
  tags = [],
  variant = 'default',
} = Astro.props;

const locale = (import.meta.env.PUBLIC_LOCALE as BaseEnv['PUBLIC_LOCALE']) || 'en';

const cardClasses = {
  default:
    'bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-gray-300 dark:border-gray-700 shadow-md hover:shadow-xl',
  featured:
    'bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm border-2 border-purple-300 dark:border-purple-700 bg-gradient-to-br from-purple-50/50 to-cyan-50/50 dark:from-purple-900/20 dark:to-cyan-900/20 shadow-lg hover:shadow-2xl',
  minimal:
    'bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-lg',
};

const tagVariants = {
  default:
    'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-600',
  featured: 'bg-gradient-to-r from-purple-500 to-cyan-500 text-white shadow-md',
  minimal: 'bg-slate-100 dark:bg-slate-700 text-gray-700 dark:text-gray-200',
};

const textClasses = {
  default: 'text-gray-600 dark:text-gray-300',
  featured: 'text-gray-700 dark:text-gray-200',
  minimal: 'text-gray-600 dark:text-gray-300',
};

const metaClasses = {
  default: 'text-sm text-gray-500 dark:text-gray-400',
  featured: 'text-sm text-gray-600 dark:text-gray-300',
  minimal: 'text-sm text-gray-500 dark:text-gray-400',
};
---

<article
  class={`group ${cardClasses[variant]} rounded-2xl overflow-hidden transition-all duration-500 hover:scale-[1.02] hover:-translate-y-1`}
>
  <!-- Image or Placeholder -->
  <div
    class="relative overflow-hidden bg-gradient-to-br from-cyan-500/20 to-purple-500/20"
    style="height: 320px;"
  >
    {
      image ? (
        <img
          src={image}
          alt={title}
          class="w-full h-full object-cover object-center group-hover:scale-110 transition-transform duration-700 ease-out"
          loading="lazy"
          style="min-height: 320px;"
        />
      ) : (
        <div
          class="w-full h-full flex items-center justify-center bg-gradient-to-br from-cyan-400 to-purple-500"
          style="min-height: 320px;"
        >
          <div class="bg-white/20 backdrop-blur-sm p-4 rounded-full">
            <svg
              class="w-12 h-12 text-white drop-shadow-lg"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
                d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"
              />
            </svg>
          </div>
        </div>
      )
    }

    <!-- Featured badge for featured variant -->
    {
      variant === 'featured' && (
        <div class="absolute top-4 right-4 bg-gradient-to-r from-purple-600 to-cyan-600 px-3 py-1 rounded-full text-white text-sm font-semibold shadow-lg">
          ‚≠ê Featured
        </div>
      )
    }
  </div>

  <!-- Content -->
  <div class="p-6 space-y-4 bg-white dark:bg-gray-800">
    <!-- Meta Information -->
    <div class={`flex items-center justify-between ${metaClasses[variant]}`}>
      <time datetime={date} class="flex items-center gap-1">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path
            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"
          ></path>
        </svg>
        {
          new Date(date).toLocaleDateString(locale, {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
          })
        }
      </time>
      {
        author && (
          <span class="flex items-center gap-1">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
            </svg>
            <span class="sr-only">Author:</span>
            {author}
          </span>
        )
      }
    </div>

    <!-- Title with better contrast -->
    <h2
      class={`text-xl font-bold transition-all duration-300 group-hover:scale-105 ${
        variant === 'featured'
          ? 'text-gray-800 dark:text-white group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-purple-600 group-hover:to-cyan-600'
          : 'text-gray-800 dark:text-white group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-cyan-600 group-hover:to-purple-600'
      }`}
    >
      <a
        href={`/blog/${slug}/`}
        class="block focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900 rounded-lg"
        aria-label={`Read article: ${title}`}
      >
        {title}
      </a>
    </h2>

    <!-- Description -->
    {
      description && (
        <p class={`line-clamp-3 leading-relaxed ${textClasses[variant]}`}>{description}</p>
      )
    }

    <!-- Tags -->
    {
      tags.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {tags.slice(0, 3).map((tag: string) => (
            <span
              class={`px-3 py-1 text-xs rounded-full font-medium transition-all duration-300 hover:scale-105 ${tagVariants[variant]}`}
            >
              {tag}
            </span>
          ))}
          {tags.length > 3 && (
            <span class="px-3 py-1 text-xs bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-full font-medium text-gray-700 dark:text-gray-200">
              +{tags.length - 3}
            </span>
          )}
        </div>
      )
    }

    <!-- Read More Link -->
    <div class="pt-2">
      <a
        href={`/blog/${slug}/`}
        class="inline-flex items-center gap-2 bg-gradient-to-r from-cyan-600 to-purple-600 bg-clip-text text-transparent font-semibold transition-all duration-300 hover:gap-3 group/link focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900 rounded-lg"
        aria-label={`Read full article: ${title}`}
      >
        Artikel lesen
        <svg
          class="w-4 h-4 text-purple-600 transition-transform group-hover/link:translate-x-1"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"
          ></path>
        </svg>
      </a>
    </div>
  </div>

  <!-- Subtle animation overlay -->
  <div
    class="absolute inset-0 bg-gradient-to-t from-transparent via-transparent to-white/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"
  >
  </div>
</article>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
